{% comment %}
  Featured Collection Section
  Horizontal scrolling product showcase
{% endcomment %}

<section class="featured-collection">
  <div class="featured-collection__header">
    <div class="featured-collection__title-wrap">
      {% if section.settings.subheading != blank %}
        <p class="featured-collection__subheading">{{ section.settings.subheading }}</p>
      {% endif %}
      <h2 class="featured-collection__title">
        {{ section.settings.heading | default: section.settings.collection.title }}
      </h2>
    </div>

    {% if section.settings.collection %}
      <a href="{{ section.settings.collection.url }}" class="featured-collection__link btn btn-ghost">
        View All
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
      </a>
    {% endif %}
  </div>

  <div class="featured-collection__slider" data-slider>
    <div class="featured-collection__track" data-slider-track>
      {% if section.settings.collection %}
        {% for product in section.settings.collection.products limit: section.settings.products_to_show %}
          <div class="featured-collection__slide">
            {% render 'product-card', product: product, lazy_load: true %}
          </div>
        {% endfor %}
      {% else %}
        {% for i in (1..6) %}
          <div class="featured-collection__slide">
            <article class="product-card">
              <div class="product-card__media">
                <div class="product-card__placeholder">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                </div>
              </div>
              <div class="product-card__info">
                <h3 class="product-card__title"><a>Product Title</a></h3>
                <div class="product-card__price">$0.00</div>
              </div>
            </article>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- Navigation Arrows -->
    <button
      class="featured-collection__nav featured-collection__nav--prev hide-mobile"
      data-slider-prev
      aria-label="Previous"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button
      class="featured-collection__nav featured-collection__nav--next hide-mobile"
      data-slider-next
      aria-label="Next"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>

  <!-- Progress Dots -->
  <div class="featured-collection__dots hide-desktop" data-slider-dots></div>
</section>

{% stylesheet %}
  .featured-collection {
    position: relative;
  }

  .featured-collection__header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: var(--space-4);
    margin-bottom: var(--space-8);
  }

  .featured-collection__subheading {
    font-size: var(--text-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-accent);
    margin-bottom: var(--space-2);
  }

  .featured-collection__title {
    font-size: var(--text-3xl);
  }

  .featured-collection__link {
    flex-shrink: 0;
  }

  /* Slider */
  .featured-collection__slider {
    position: relative;
  }

  .featured-collection__track {
    display: flex;
    gap: var(--product-card-gap);
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: var(--space-4);
    margin-bottom: calc(var(--space-4) * -1);
  }

  .featured-collection__track::-webkit-scrollbar {
    display: none;
  }

  .featured-collection__slide {
    flex: 0 0 calc(25% - var(--product-card-gap) * 3 / 4);
    scroll-snap-align: start;
  }

  @media (max-width: 1200px) {
    .featured-collection__slide {
      flex: 0 0 calc(33.333% - var(--product-card-gap) * 2 / 3);
    }
  }

  @media (max-width: 768px) {
    .featured-collection__slide {
      flex: 0 0 calc(50% - var(--product-card-gap) / 2);
    }
  }

  @media (max-width: 480px) {
    .featured-collection__slide {
      flex: 0 0 80%;
    }
  }

  /* Navigation */
  .featured-collection__nav {
    position: absolute;
    top: 50%;
    transform: translateY(-100%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 50%;
    color: var(--color-foreground);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
    z-index: 2;
  }

  .featured-collection__nav:hover {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-accent-foreground);
  }

  .featured-collection__nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .featured-collection__nav--prev {
    left: calc(var(--space-4) * -1);
  }

  .featured-collection__nav--next {
    right: calc(var(--space-4) * -1);
  }

  /* Dots */
  .featured-collection__dots {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    margin-top: var(--space-6);
  }

  .featured-collection__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--color-border);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: background-color var(--duration-fast) var(--ease-out), transform var(--duration-fast) var(--ease-out);
  }

  .featured-collection__dot:hover,
  .featured-collection__dot.active {
    background-color: var(--color-accent);
  }

  .featured-collection__dot.active {
    transform: scale(1.25);
  }
{% endstylesheet %}

{% javascript %}
  document.querySelectorAll('[data-slider]').forEach((slider) => {
    const track = slider.querySelector('[data-slider-track]');
    const prevBtn = slider.querySelector('[data-slider-prev]');
    const nextBtn = slider.querySelector('[data-slider-next]');
    const dotsContainer = slider.closest('section').querySelector('[data-slider-dots]');
    const slides = track.children;

    if (slides.length === 0) return;

    const slideWidth = slides[0].offsetWidth + parseInt(getComputedStyle(track).gap);
    const visibleSlides = Math.round(track.offsetWidth / slideWidth);
    const totalDots = Math.ceil(slides.length / visibleSlides);

    // Create dots
    if (dotsContainer) {
      for (let i = 0; i < totalDots; i++) {
        const dot = document.createElement('button');
        dot.className = 'featured-collection__dot' + (i === 0 ? ' active' : '');
        dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
        dot.addEventListener('click', () => {
          track.scrollTo({ left: i * slideWidth * visibleSlides, behavior: 'smooth' });
        });
        dotsContainer.appendChild(dot);
      }
    }

    // Navigation
    const updateNav = () => {
      const scrollLeft = track.scrollLeft;
      const maxScroll = track.scrollWidth - track.offsetWidth;

      if (prevBtn) prevBtn.disabled = scrollLeft <= 0;
      if (nextBtn) nextBtn.disabled = scrollLeft >= maxScroll - 10;

      // Update dots
      if (dotsContainer) {
        const currentDot = Math.round(scrollLeft / (slideWidth * visibleSlides));
        dotsContainer.querySelectorAll('.featured-collection__dot').forEach((dot, i) => {
          dot.classList.toggle('active', i === currentDot);
        });
      }
    };

    prevBtn?.addEventListener('click', () => {
      track.scrollBy({ left: -slideWidth * visibleSlides, behavior: 'smooth' });
    });

    nextBtn?.addEventListener('click', () => {
      track.scrollBy({ left: slideWidth * visibleSlides, behavior: 'smooth' });
    });

    track.addEventListener('scroll', updateNav);
    updateNav();
  });
{% endjavascript %}

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "featured-collection-section",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "New Arrivals"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Latest Drops"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 16,
      "step": 2,
      "label": "Products to show",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Featured Collection"
    }
  ]
}
{% endschema %}
